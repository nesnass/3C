<md-tab-group>

  <md-tab label="Groupings">

    <div fxLayout="row wrap">
      <md-card *ngFor="let grouping of listingService.groupingsReverseSortedByCreationDate | async; let i=index;" class="grouping-card">

        <div *ngIf="itemToEdit !== i">
          <md-card-header>
            <div md-card-avatar>
              <md-icon md-list-icon>{{grouping.displayMode === 'Voting' ? 'check_circle' : 'collections'}}</md-icon>
            </div>
            <md-card-title>{{ grouping.titleDescriptionMode === 'Custom' ? grouping.categoryTitle : 'Generated from Album title'}}</md-card-title>
            <md-card-subtitle>{{ grouping.titleDescriptionMode === 'Custom' ? grouping.categorySubtitle : 'Generated from Album description'}}</md-card-subtitle>
          </md-card-header>
          <md-card-content>
            <p><a style="word-break: break-all;" href="{{ appUrl() + displayMode(grouping) + grouping.urlSlug}}" [target]="'_blank' + grouping._id">{{ appUrl() + displayMode(grouping) }}<strong>{{grouping.urlSlug}}</strong></a></p>
            <p>Display Mode: <strong>{{grouping.displayMode}}</strong></p>
            <p>Contribution selection: <strong>{{grouping.contributionMode}}</strong></p>
          </md-card-content>
          <md-card-actions>
            <button md-line md-button (click)="itemToEdit = i">Edit</button>
            <button md-line md-button color="red" (click)="deleteAtServer(grouping)">Delete</button>
          </md-card-actions>
        </div>

        <div *ngIf="itemToEdit === i">
          <md-card-content fxLayout="column">
            <h2>Title & Description</h2>
            <md-radio-group [(ngModel)]="grouping.titleDescriptionMode">
              <md-radio-button class="creator-voting-radio-button" *ngFor="let mode of titleDescriptionModes" [value]="mode.viewValue">
                {{mode.viewValue}}
              </md-radio-button>
            </md-radio-group>
            <div *ngIf="grouping.titleDescriptionMode === 'Automatic'">
              <p>{{grouping.displayMode === 'Voting' ? 'Question' : 'Title'}} is generated from Album title</p>
              <p>Subtitle is generated from Album description</p>
            </div>
            <div *ngIf="grouping.titleDescriptionMode === 'Custom'">
              <md-input-container>
                <input mdInput placeholder="Category Title" [(ngModel)]="grouping.categoryTitle" autofocus>
              </md-input-container><br>
              <md-input-container>
                <input mdInput placeholder="Category Subtitle" [(ngModel)]="grouping.categorySubtitle">
              </md-input-container>
            </div>
            <h2>Display</h2>
            <md-input-container>
              <input mdInput placeholder="URL" [(ngModel)]="grouping.urlSlug">
            </md-input-container>
            <md-select placeholder="Present view as" [(ngModel)]="grouping.displayMode">
              <md-option *ngFor="let mode of displayModes" [value]="mode.viewValue">
                {{ mode.viewValue }}
              </md-option>
            </md-select>
            <div *ngIf="grouping.displayMode === 'Voting'">
              <h2>Voting Options</h2>
              <md-radio-group [(ngModel)]="grouping.votingOptions.displayMode">
                <md-radio-button class="creator-voting-radio-button" *ngFor="let mode of votingDisplayModes" [value]="mode.viewValue">
                  {{mode.viewValue}}
                </md-radio-button>
              </md-radio-group>
              <md-checkbox [(ngModel)]="grouping.votingOptions.imageCaption">Image Caption</md-checkbox>
              <md-checkbox [(ngModel)]="grouping.votingOptions.resultsVisible">Results Visible</md-checkbox>
            </div>
            <div *ngIf="grouping.displayMode === 'Serendipitous'">
              <h2>Display Options</h2>
              <md-checkbox [(ngModel)]="grouping.serendipitousOptions.randomSelection">Random Selection</md-checkbox>
            </div>
            <hr>
            <h2>Contributions</h2>
            <md-select placeholder="Select Contributions using" [(ngModel)]="grouping.contributionMode">
              <md-option *ngFor="let mode of contributionModes" [value]="mode.viewValue">
                {{ mode.viewValue }}
              </md-option>
            </md-select>
            <div *ngIf="grouping.contributionMode === 'Chips'">
              <p>Show contributions from selected album titles: (click to select)</p>
              <md-chip-list>
                <md-basic-chip class="custom-chip" *ngFor="let chip of listingService.chips" [ngStyle]="chipStyle(chip, grouping)" [selected]="grouping.chips.indexOf(chip._id) > -1" (click)="toggleChip(grouping, 'Grouping', chip)">{{chip.label}}</md-basic-chip>
              </md-chip-list>
            </div>
          </md-card-content>
          <hr>
          <md-card-actions>
            <button md-button (click)="updateToServer(grouping, 'Grouping'); itemToEdit = -1">Done</button>
          </md-card-actions>
        </div>

      </md-card>

      <md-card class="grouping-card">
        <md-card-header>
          <md-card-title><a md-button (click)="addGrouping()"><md-icon md-list-icon>add</md-icon>New Grouping</a></md-card-title>
        </md-card-header>
        <md-card-content></md-card-content>
      </md-card>

    </div>
  </md-tab>


  <md-tab label="Contributions">

    <div fxLayout="row wrap">
      <md-card *ngFor="let contribution of listingService.contributions | async" class="contribution-card">
        <md-card-header>
          <div md-card-avatar class="contribution-card-header-image" [ngStyle]="{'background-image': 'url(\'' + contribution.user.profile_picture + '\')' }"></div>
          <md-card-title>{{contribution.user.username}}</md-card-title>
          <md-card-subtitle>{{contribution.created.toString()}}</md-card-subtitle>
        </md-card-header>
        <img md-card-image [src]="contribution.image.url" alt="The contributed image">
        <md-card-content>
          <p>{{contribution.caption}}</p>
          <md-chip-list>
            <md-basic-chip class="custom-chip" *ngFor="let chip of listingService.chips" [ngStyle]="chipStyle(chip, contribution)" [selected]="contribution.chips.indexOf(chip._id) > -1" (click)="toggleChip(contribution, 'Contribution', chip)">{{chip.label}}</md-basic-chip>
          </md-chip-list>
        </md-card-content>
      </md-card>
    </div>

  </md-tab>

  <md-tab label="Chips">

    <div fxLayout="row wrap">
      <md-card *ngFor="let chip of listingService.chips" class="chip-card">
        <md-card-header>
          <div md-card-avatar class="contribution-card-header-image" [ngStyle]="chipStyle(chip)"></div>
          <md-card-title>{{chip.label}}</md-card-title>
          <md-card-subtitle>{{chip.origin}}</md-card-subtitle>
        </md-card-header>
        <md-card-content>
          <p>{{chip.description}}</p>
          <p>{{chip.location}}</p>
        </md-card-content>
      </md-card>
    </div>

  </md-tab>

</md-tab-group>
